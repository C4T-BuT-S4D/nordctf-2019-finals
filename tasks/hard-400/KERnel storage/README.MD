# Hard-400 | Reverse/Pwn | KERnel storage

## Информация

> Смотри какое хранилище ядер я нашёл на Али....
> Всё выглядит безопасно, разве нет?
> `nc address 33073`


## Запуск

```sh
cd deploy
./make_docker.sh
./worker.sh
```


## Описание

Дан бинарник внутри которого реализованы двусвязные списки для хранения описаний ядер.


## Решение

В двусвязные списки сохранялись объекты стуктуры ядра. Также был реализован некоторый кеш в виде глобального указателя на объект. При этом, перед удалением объекта он помещался в кеш. Была небезопасная функция работы с объектом в кэше, которая не проверяла его наличие в двусвязном списке. Также была функция изменения описания пользователя, которая позволяла выделять произволный чанк на куче.

Собрав всё это воедино можно было устроить следующую атаку типа UAF:
1. Создаём любой объект
2. Удаляем его
3. Изменяем описание пользователя выделяя чанк необходимого размера (равного размеру структуре kernel)
4. Записываем в чанк данные таким образом, чтобы получить AW (по сути в одном поле нужно просто указать адрес, куда мы будет писать изменяя описание ядра, т.к. описания ядра было в виде char* desc)
5. Используем небезопасную функцию изменения описания для объекта в кеше.
6. Перезаписываем функцию в GOT на функцию чтения файла "debug" (можно было найти внтури бинаря)
7. ????
8. PROFIT

[Пример эксплоита](solve/exploit.py)


## Флаг

`flag{96118d080f35115bbfb0d5a497e63fa6fc05b83b1e2da7baee6c37c8ab4da880}`
