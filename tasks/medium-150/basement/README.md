# Medium-150 | Reverse/Crypto | Basement

## Информация

> Наши учёные разработали инновационную систему шифрования, в основе которой используется ключ. Они утверждают, что без ключа расшифровать файл невозможно. Подробное описание в открытом доступе отсутствует, но учёные предоставили вам программу, которая реализует их шифр.
> 
> [Basement.exe](Basement.exe) [flag.enc](flag.enc)


## Генерация

```sh
./generate.sh
```


## Описание

Выдаётся бинарник на .NET, который реализует шифрование и дешифрование. В основе шифрования лежит применение кодирования [Base64](https://ru.wikipedia.org/wiki/Base64) 16 раз, затем [XOR](https://ru.wikipedia.org/wiki/XOR) каждых четырёх символов с числами из `Random.Next()`. Дешифрование происходит в обратном порядке. Ключ шифра — сид рандомного генератора, он неизвестен.


## Решение

Поскольку рандом в .NET не является криптостойким (да и вообще хоть как-то защищённым), то мы можем восстановить следующие значения `Random.Next()`, зная **55** предыдущих выводов. 55 32-битных чисел рандома — это **220** байтов, то есть нам нужно знать первые 220 символов открытого текста, чтобы восстановить остальные. К счастью, мы их знаем, так как знаем префикс флага — `flag{`, от которого 16 раз нужно взять base64.

[Пример эксплоита](exploit.py)


## Флаг

Флаг лежит в файле [flag.txt](flag.txt).

`flag{oh_wait_this_random_is_not_secure}`
